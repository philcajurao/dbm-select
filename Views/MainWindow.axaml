<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:vm="using:dbm_select.ViewModels"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		mc:Ignorable="d" d:DesignWidth="1024" d:DesignHeight="800"
		Width="1024"
		Height="800"
		x:Class="dbm_select.Views.MainWindow"
		x:DataType="vm:MainWindowViewModel"
		Icon="/Assets/avalonia-logo.ico"
		Title="DBM Estudyo"
		Background="#fefefe">

	<Design.DataContext>
		<vm:MainWindowViewModel/>
	</Design.DataContext>

	<!-- ✅ ADDED x:Name="MainGrid" for coordinate calculations -->
	<Grid ColumnDefinitions="Auto, *" x:Name="MainGrid">

		<!-- Side Dropping Area -->
		<Border Grid.Column="0"
				Padding="0,16"
				BoxShadow="0 0 24 0 #d3d3d3">
			<Grid RowSpacing="8"
				  RowDefinitions="Auto, *, Auto">
				<TextBlock Grid.Row="0"
						   HorizontalAlignment="Center"
						   Padding="8,0"
						   Foreground="#1e1e1e">DBM Estudyo</TextBlock>

				<!-- Drop Targets Container -->
				<StackPanel Grid.Row="1"
							HorizontalAlignment="Center"
							VerticalAlignment="Center"
							Spacing="24">

					<!--
					✅ REMOVED DragDrop attributes.
					We now detect drops manually in OnPointerReleased logic.
					-->

					<!-- 8x16 Box -->
					<Border BorderBrush="Gray"
							BorderThickness="1"
							Width="72"
							Height="120"
							Tag="8x16"
							Background="Transparent">
						<Panel>
							<TextBlock HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   FontSize="8"
									   TextWrapping="Wrap"
									   TextAlignment="Center"
									   Foreground="#1e1e1e"
									   Text="8x16"
									   IsVisible="{Binding Image8x16, Converter={x:Static ObjectConverters.IsNull}}"/>
							<Image Source="{Binding Image8x16.Bitmap}"
								   Stretch="UniformToFill"
								   IsVisible="{Binding Image8x16, Converter={x:Static ObjectConverters.IsNotNull}}"/>
						</Panel>
					</Border>

					<!-- Barong Box -->
					<Border BorderBrush="Gray"
							BorderThickness="1"
							Width="72"
							Height="120"
							Tag="Barong"
							Background="Transparent">
						<Panel>
							<TextBlock HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   FontSize="8"
									   TextWrapping="Wrap"
									   TextAlignment="Center"
									   Foreground="#1e1e1e"
									   Text="Barong"
									   IsVisible="{Binding ImageBarong, Converter={x:Static ObjectConverters.IsNull}}"/>
							<Image Source="{Binding ImageBarong.Bitmap}"
								   Stretch="UniformToFill"
								   IsVisible="{Binding ImageBarong, Converter={x:Static ObjectConverters.IsNotNull}}"/>
						</Panel>
					</Border>

					<!-- Toga Box -->
					<Border BorderBrush="Gray"
							BorderThickness="1"
							Width="72"
							Height="120"
							Tag="Toga"
							Background="Transparent">
						<Panel>
							<TextBlock HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   FontSize="8"
									   TextWrapping="Wrap"
									   TextAlignment="Center"
									   Foreground="#1e1e1e"
									   Text="Toga"
									   IsVisible="{Binding ImageToga, Converter={x:Static ObjectConverters.IsNull}}"/>
							<Image Source="{Binding ImageToga.Bitmap}"
								   Stretch="UniformToFill"
								   IsVisible="{Binding ImageToga, Converter={x:Static ObjectConverters.IsNotNull}}"/>
						</Panel>
					</Border>

					<!-- Any Photo Box -->
					<Border BorderBrush="Gray"
							BorderThickness="1"
							Width="72"
							Height="120"
							Tag="Any Photo"
							Background="Transparent">
						<Panel>
							<TextBlock HorizontalAlignment="Center"
									   VerticalAlignment="Center"
									   FontSize="8"
									   TextWrapping="Wrap"
									   TextAlignment="Center"
									   Foreground="#1e1e1e"
									   Text="Any Photo"
									   IsVisible="{Binding ImageAnyPhoto, Converter={x:Static ObjectConverters.IsNull}}"/>
							<Image Source="{Binding ImageAnyPhoto.Bitmap}"
								   Stretch="UniformToFill"
								   IsVisible="{Binding ImageAnyPhoto, Converter={x:Static ObjectConverters.IsNotNull}}"/>
						</Panel>
					</Border>
				</StackPanel>

				<Grid Grid.Row="2"
					  ColumnDefinitions="*, *"
					  HorizontalAlignment="Center">
					<Button Grid.Column="0"
							Width="40"
							Height="16"
							FontSize="8"
							Padding="2"
							HorizontalContentAlignment="Center"
							Foreground="#1e1e1e">Submit</Button>
					<Button Grid.Column="1"
							Command="{Binding ClearAllCommand}"
							Width="40"
							Height="16"
							FontSize="8"
							Padding="2"
							HorizontalContentAlignment="Center"
							Foreground="#1e1e1e">Clear All</Button>
				</Grid>
			</Grid>
		</Border>

		<!-- Main Content Area -->
		<Grid RowDefinitions="Auto, *, Auto"
			  ColumnDefinitions="*, *"
			  Grid.Column="1"
			  ColumnSpacing="16"
			  RowSpacing="16"
			  Margin="16">

			<!--Top Input Data Area-->
			<Border CornerRadius="8"
					Padding="24"
					BoxShadow="0 2 24 0 #d3d3d3"
					Grid.Row="0"
					Grid.Column="0"
					Grid.ColumnSpan="2">

				<!-- Redesigned Input Layout -->
				<Grid ColumnDefinitions="Auto, *, Auto" VerticalAlignment="Center">

					<!-- Text Inputs -->
					<StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="20">
						<StackPanel Spacing="5">
							<TextBlock Text="Email Address" FontSize="10" Foreground="#888"/>
							<TextBox Width="200"
									 Text="{Binding ClientEmail}"
									 Watermark="e.g. client@email.com"
									 Cursor="IBeam"/>
						</StackPanel>

						<StackPanel Spacing="5">
							<TextBlock Text="Client Name" FontSize="10" Foreground="#888"/>
							<TextBox Width="200"
									 Text="{Binding ClientName}"
									 Watermark="e.g. John Doe"
									 Cursor="IBeam"/>
						</StackPanel>
					</StackPanel>

					<!-- Package Selection -->
					<StackPanel Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center" Spacing="5">
						<TextBlock Text="Select Package" FontSize="10" Foreground="#888" HorizontalAlignment="Right"/>
						<StackPanel Orientation="Horizontal" Spacing="15">
							<RadioButton Foreground="#888" GroupName="Package Group" Content="Basic" IsChecked="True" Cursor="Hand"/>
							<RadioButton Foreground="#888" GroupName="Package Group" Content="Pkg A" Cursor="Hand"/>
							<RadioButton Foreground="#888" GroupName="Package Group" Content="Pkg B" Cursor="Hand"/>
							<RadioButton Foreground="#888" GroupName="Package Group" Content="Pkg C" Cursor="Hand"/>
							<RadioButton Foreground="#888" GroupName="Package Group" Content="Pkg D" Cursor="Hand"/>
						</StackPanel>
					</StackPanel>

				</Grid>
			</Border>

			<!--Browse Photos Area-->
			<Border CornerRadius="8"
					Padding="24"
					BoxShadow="0 2 24 0 #d3d3d3"
					Grid.Row="1"
					Grid.Column="0">
				<Grid RowDefinitions="Auto, *">
					<TextBlock Grid.Row="0"
							   Text="Browse Photos"
							   FontSize="8"
							   Foreground="#1e1e1e"
							   Margin="0,0,0,10"/>

					<ListBox Grid.Row="1"
							 ItemsSource="{Binding Images}"
							 SelectedItem="{Binding SelectedImage}"
							 Background="Transparent">

						<ListBox.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel Orientation="Horizontal" />
							</ItemsPanelTemplate>
						</ListBox.ItemsPanel>

						<ListBox.Styles>
							<Style Selector="ListBoxItem">
								<Setter Property="Padding" Value="4"/>
								<Setter Property="CornerRadius" Value="4"/>
							</Style>
						</ListBox.Styles>

						<ListBox.ItemTemplate>
							<DataTemplate>
								<!-- ✅ ADDED: PointerReleased to handle the 'Drop' -->
								<Border Classes="image-tile"
										PointerPressed="OnPointerPressed"
										PointerMoved="OnPointerMoved"
										PointerReleased="OnPointerReleased"
										Background="Transparent">
									<StackPanel Margin="5" Width="100">
										<Image Source="{Binding Bitmap}"
											   Width="80"
											   Height="80"
											   Stretch="UniformToFill"
											   HorizontalAlignment="Center"/>
										<TextBlock Text="{Binding FileName}"
												   TextWrapping="Wrap"
												   HorizontalAlignment="Center"
												   FontSize="10"
												   Foreground="Black"
												   Margin="0,5,0,0"/>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</Grid>
			</Border>

			<!--Quick Preview Area-->
			<Border CornerRadius="8"
					Padding="24"
					BoxShadow="0 2 24 0 #d3d3d3"
					Grid.Row="1"
					Grid.Column="1">
				<Grid RowDefinitions="Auto, *, Auto">
					<TextBlock Grid.Row="0"
							   Text="Quick Preview"
							   FontSize="8"
							   Foreground="#1e1e1e"/>

					<TextBlock Grid.Row="1"
							   Text="Select a photo to preview"
							   FontSize="12"
							   Foreground="#d3d3d3"
							   HorizontalAlignment="Center"
							   VerticalAlignment="Center"
							   IsVisible="{Binding SelectedImage, Converter={x:Static ObjectConverters.IsNull}}"/>

					<Image Grid.Row="1"
						   Source="{Binding SelectedImage.Bitmap}"
						   Stretch="Uniform"
						   Margin="0,10"
						   IsVisible="{Binding SelectedImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>

					<TextBlock Grid.Row="2"
							   Text="{Binding SelectedImage.FileName}"
							   FontSize="14"
							   FontWeight="Bold"
							   Foreground="#1e1e1e"
							   HorizontalAlignment="Center"
							   IsVisible="{Binding SelectedImage, Converter={x:Static ObjectConverters.IsNotNull}}"/>
				</Grid>
			</Border>

			<!--Sample Preview Package Area-->
			<Border CornerRadius="8"
					Padding="24"
					BoxShadow="0 2 24 0 #d3d3d3"
					Grid.Row="2"
					Grid.Column="0"
					Grid.ColumnSpan="2">
				<TextBlock Text="Sample Preview Package"
						   FontSize="8"
						   Foreground="#1e1e1e"/>
			</Border>
		</Grid>

		<!-- ✅ NEW: Ghost Image Overlay Layer -->
		<!-- IsHitTestVisible="False" ensures clicks go through it to the borders below -->
		<Canvas x:Name="DragCanvas"
				Grid.Column="0"
				Grid.ColumnSpan="2"
				IsHitTestVisible="False"
				IsVisible="False"
				ZIndex="100">
			<Image x:Name="GhostImage"
				   Width="80"
				   Height="80"
				   Opacity="0.7"
				   Stretch="UniformToFill"/>
		</Canvas>

	</Grid>

</Window>